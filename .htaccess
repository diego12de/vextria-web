# ----------------------------------------------------------------------
# | VEXTRIA - Configuración Fase Lanzamiento (Sin riesgos)             |
# ----------------------------------------------------------------------

# 1. CABECERAS DE SEGURIDAD
<IfModule mod_headers.c>
# Evita que otros incrusten tu web (protección clickjacking)
Header set X-Frame-Options "SAMEORIGIN"
# Evita ataques de tipo MIME
Header set X-Content-Type-Options "nosniff"
# Activa protección XSS en navegadores antiguos
Header set X-XSS-Protection "1; mode=block"
    
# NOTA: HSTS eliminado para evitar bloqueos si falla el SSL
</IfModule>

# 2. REDIRECCIONES
<IfModule mod_rewrite.c>
RewriteEngine On

# A) Forzar HTTPS
RewriteCond % { HTTPS } off
RewriteRule ^(.*)$ https://% { HTTP_HOST }/$1 [R=301, L]

# B) Quitar www (Redirigir www.vextria.es a vextria.es)
RewriteCond % { HTTP_HOST } ^www\.(.*)$ [NC]
RewriteRule ^(.*)$ https://%1/$1 [R=301, L]
    
# C) Quitar barra final (Trailing Slash)
RewriteCond % { REQUEST_FILENAME } !-d
RewriteRule ^(.*)/$ /$1 [L, R=301]
</IfModule>

# 3. CACHÉ DEL NAVEGADOR
<IfModule mod_expires.c>
ExpiresActive On
    
# NOTA: Eliminado "ExpiresDefault" para evitar la trampa del caché de 1 mes.
# CSS y JS se cargarán frescos cada vez (o según decida el servidor por defecto).

# HTML: 0 segundos (Siempre comprueba si hay cambios)
ExpiresByType text/html "access plus 0 seconds"

# Imágenes y Fuentes: 1 año
# (Esto es seguro mantenerlo porque el logo y fotos no cambian a diario)
ExpiresByType image/jpg "access plus 1 year"
ExpiresByType image/jpeg "access plus 1 year"
ExpiresByType image/png "access plus 1 year"
ExpiresByType image/webp "access plus 1 year"
ExpiresByType image/svg+xml "access plus 1 year"
ExpiresByType font/woff2 "access plus 1 year"
</IfModule>

# 4. PÁGINAS DE ERROR
ErrorDocument 404 /404.html
<IfModule mod_headers.c>
    # Permitir que Clarity (y otros) carguen tus fuentes y estilos
    <FilesMatch "\.(ttf|ttc|otf|eot|woff|woff2|font.css|css|js)$">
        Header set Access-Control-Allow-Origin "*"
    </FilesMatch>
</IfModule>
